package main

import (
	"context"
	"encoding/json"
	"fmt"
	"reflect"
	"strconv"

	"github.com/adshao/go-binance/v2"
)

func main() {
	fmt.Println("------------------------------------------------------------------")
	fmt.Println("------------------------------------------------------------------")
	var (
		apiKey    = "mlxVdHIyxdRQNG4cTiDy8GMSf1Q10C4iwZQr7Uj2kfBL95KbO99vqK1PTtZLT4h2"
		secretKey = "6a4ADHGMbMAAD34Aw9kqNcTgXWQWLu1bY2u9SmIgWxRgK0jGoMYhCAHXedh3oyMc"
	)
	futuresClient := binance.NewFuturesClient(apiKey, secretKey)

	res, err := futuresClient.NewDepthService().Symbol("BTCUSDT").Do(context.Background())
	if err != nil {
		fmt.Println(err)
		return
	}
	// fmt.Println(res)

	depthVar, _ := json.Marshal(res)
	// fmt.Println(string(depthVar))

	type AutoGenerated struct {
		LastUpdateID int64 `json:"lastUpdateId"`
		E            int64 `json:"E"`
		T            int64 `json:"T"`
		Bids         []struct {
			Price    string `json:"Price"`
			Quantity string `json:"Quantity"`
		} `json:"bids"`
		Asks []struct {
			Price    string `json:"Price"`
			Quantity string `json:"Quantity"`
		} `json:"asks"`
	}

	var autoGenerated AutoGenerated
	json.Unmarshal(depthVar, &autoGenerated)
	fmt.Println("ASK: ", autoGenerated.Asks[0].Price, autoGenerated.Asks[0].Quantity)
	fmt.Println("BID: ", autoGenerated.Bids[0].Price, autoGenerated.Bids[0].Quantity)
	fmt.Println("------------------------------------------------------------------")

	resAcc, err := futuresClient.NewGetAccountService().Do(context.Background())
	if err != nil {
		fmt.Println(err)
		return
	}
	fmt.Println(resAcc.AvailableBalance, "-", reflect.TypeOf(resAcc.AvailableBalance))

	startBalance := 19.12184272 - 7.53667852
	futuresProfit := 0.0

	if balanceNow, err := strconv.ParseFloat(resAcc.AvailableBalance, 64); err == nil {
		fmt.Println(balanceNow, "-", reflect.TypeOf(balanceNow))
		futuresProfit = startBalance - balanceNow
	}
	fmt.Println(startBalance, reflect.TypeOf(startBalance))
	fmt.Println(futuresProfit)
}
